<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Supabase CRUD (HTML + JS)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    input, select, button { margin: 5px; padding: 8px; }
    .task, .card, .user { 
      margin: 10px 0; 
      padding: 8px; 
      border: 1px solid #ccc; 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
    }
    .task button, .card button { 
      background: red; 
      color: white; 
      border: none; 
      padding: 5px 10px; 
      cursor: pointer; 
      border-radius: 4px; 
    }
     body { font-family: Arial, sans-serif; margin: 40px; }
    input, button { margin: 5px; padding: 8px; }
    .box { margin-bottom: 20px; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
     body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { margin: 5px; padding: 8px; }
    .product { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
    button { cursor: pointer; }
  </style>
</head>
<!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    function sankalp(){
    console.log('sankalp called');
}
    // Supabase setup
    const supabaseUrl = "https://dklcbcbgpdrqsqupaaeb.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRrbGNiY2JncGRycXNxdXBhYWViIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NzI1ODk1MiwiZXhwIjoyMDcyODM0OTUyfQ.EN8lHW9BBf1qSNXw9fFnFU1rWgIoOsWqltks57qp-pY"; // apna anon key lagao
    const client = supabase.createClient(supabaseUrl, supabaseKey);

    /* ---------------- CARDS CRUD ---------------- */

    // add to card
   

    // delete card api
   

    /* ---------------- USERS CRUD ---------------- */

    // get User api 
async function loadUsers() {
  const { data, error } = await client
    .from("Users")
    .select("*")
    .order("user_id", { ascending: true });

  if (error) {
    console.error(error);
    return;
  }

  const userList = document.getElementById("userList");
  userList.innerHTML = "";

  data.forEach((u) => {
    userList.innerHTML += `
      <div class="user">
        ğŸ‘¤ <b>${u.Name}</b>  
        | ğŸ†” <b>${u.user_id}</b>
        | ğŸ“§ ${u.Email || "N/A"}  
        | ğŸ“± ${u.phonenumber || "N/A"}  
        | <small>Created: ${u.createddate}</small>
      </div>
    `;
  });
}




    // Page load pe cards load karein
    

     async function loadUsers() {
      const { data, error } = await client.from("Users").select("user_id, Name, lastname, Email, phonenumber, createddate").order("user_id", { ascending: true });
      if (error) { console.error(error); alert("Error fetching users"); return; }

      const userList = document.getElementById("userList");
      userList.innerHTML = "";
      data.forEach(u => {
        userList.innerHTML += `
          <div class="user">
            <div>ğŸ‘¤ <b>${u.Name}</b> ${u.lastname || ""} | ğŸ†” <b>${u.user_id}</b> | ğŸ“§ ${u.Email || "N/A"} | ğŸ“± ${u.phonenumber || "N/A"}</div>
            <div><small>Created: ${u.createddate}</small></div>
          </div>`;
      });
    }

    // ---------------- ADD USER (includes password) ----------------
    // Adds user and sets window.currentUserId to the inserted user's id (so you can immediately add cards)
    // sinup api endpoints
    async function addUser(userUUID) {


  const name = document.getElementById("firstName").value.trim();
  const lastName = document.getElementById("lastName").value.trim();
  const email = document.getElementById("email").value.trim();
  const phoneNumber = document.getElementById("phoneNumber").value.trim();
  const password = document.getElementById("password").value; // raw password (testing only)

  if (!name || !lastName || !email || !phoneNumber || !password) {
    alert("Please fill all fields!");
    return;
  }

  const { data, error } = await client
    .from("Users")
    .insert([{
      user_id: userUUID,   // âœ… Auth se mila UUID yaha save karna hai
      Name: name,
      lastname: lastName,
      Email: email,
      phonenumber: phoneNumber,
      password: password,
      createddate: new Date().toISOString()
    }])
    .select();

  if (error) {
    console.error(error);
    alert("Error inserting user!");
    return;
  }

  const inserted = data && data[0];
  if (inserted && inserted.user_id) {
    // âœ… Current User set karo
    window.currentUserId = inserted.user_id;
  }

  alert("User added successfully!");
  document.getElementById("firstName").value = "";
  document.getElementById("lastName").value = "";
  document.getElementById("email").value = "";
  document.getElementById("phoneNumber").value = "";
  document.getElementById("password").value = "";

  loadUsers();
}



     async function signIn() {
    const email = document.getElementById("loginEmail").value.trim();
    const password = document.getElementById("loginPassword").value.trim();

    if (!email || !password) {
      alert("Please enter email and password!");
      return;
    }

    // Check user in DB
    const { data, error } = await client
      .from("Users")
      .select("user_id, Name, Email, password")
      .eq("Email", email)
      .eq("password", password)  
      

      
      
      
     

    if (error) {
      console.error(error);
      alert("Error checking user!");
      return;
    }

    if (data.length > 0) {
      // user found
      const user = data[0];
      window.currentUserId = user.user_id; // Save logged-in user id
      alert(`Login successful! Welcome ${user.Name}`);
    } else {
      alert("Invalid email or password!");
    }
  }


  
// sinup with authenatication 
   async function signUp() {


    const name = document.getElementById("firstName").value.trim();
  const lastName = document.getElementById("lastName").value.trim();
  const email = document.getElementById("signupEmail").value.trim();
  const phoneNumber = document.getElementById("phoneNumber").value.trim();
  const password = document.getElementById("signupPassword").value; // raw password (testing only)

   console.log("name",name,"lastName", lastName,"email",email, "phoneNumber",phoneNumber,"password", password)
  if (!name || !lastName || !email || !phoneNumber || !password) {
    alert("Please fill all fields!");
    return;
  }
  



      if (!email || !password) {
        alert("Please enter email and password!");
        return;
      }

      let signUpResponse = await client.auth.signUp({ email, password });

       

      if (signUpResponse.error) {
        console.error(error);
        alert("Error: " + error.message);
      } else {

        console.log("data", signUpResponse.data);

const user = signUpResponse.data.user;

         const userUUID = user.id;
           const uuidString = String(userUUID); 

        const { data, error } = await client
    .from("Users")
    .insert([{
     Name: name,
      lastname: lastName,
      Email: email,
      phonenumber: phoneNumber,
      password: password,
      supabaseuserid :uuidString,
      createddate: new Date().toISOString()
    }])
    .select();

  if (error) {
    console.error(error);
    alert("Error inserting user!");
    return;
  }

  const inserted = data && data[0];
  if (inserted && inserted.user_id) {
    // âœ… Current User set karo
    window.currentUserId = inserted.user_id;
  }

  alert("User added successfully!");
  document.getElementById("firstName").value = "";
  document.getElementById("lastName").value = "";
  document.getElementById("email").value = "";
  document.getElementById("phoneNumber").value = "";
  document.getElementById("password").value = "";
  document.getElementById("supabaseuserid").value = "";





        alert("Signup successful! Check your email for confirmation.");

    // const userUUID = data.user?.id;


        console.log(data);
      }
    }
    

    // signin with authenatication
     async function signIn() {
      const email = document.getElementById("signinEmail").value.trim();
      const password = document.getElementById("signinPassword").value.trim();

      if (!email || !password) {
        alert("Please enter email and password!");
        return;
      }

      const { data, error } = await client.auth.signInWithPassword({ email, password });

      if (error) {
        console.error(error);
        alert("Error: " + error.message);
      } else {
        alert("Login successful! Welcome ğŸ‰");
        console.log(data);
      }
    }


    // add product api endpoint 
      

    async function fetchProducts() {
      const { data, error } = await client.from("Products").select("*");

      if (error) {
        console.error(error);
        return;
      }

      const listDiv = document.getElementById("productsList");
      listDiv.innerHTML = "";

      data.forEach(product => {
        listDiv.innerHTML += `
          <div class="product">
            <strong>ID: ${product.id}</strong><br>
            <strong>${product.productname}</strong> - Rs.${product.productPrice} 
            [Available: ${product.productavailable}]<br>
            <img src="${product.productimage}" alt="No Image" width="100"><br>
          </div>
        `;
      });
    }


document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById('productForm')

      form.addEventListener('submit', async (e) => {
        e.preventDefault()

        const productName = document.getElementById('productName').value
        const file = document.getElementById('productImage').files[0]

        if (!file) {
          alert("âŒ Please select an image")
          return
        }

        // unique filename
        const fileName = `${Date.now()}_${file.name}`

        // Upload to Supabase Storage (apne bucket ka naam daalna h)
        const { data: uploadData, error: uploadError } = await supabase.storage
          .from('product-images') // ğŸ‘ˆ apna bucket name
          .upload(fileName, file)

        if (uploadError) {
          console.error(uploadError)
          alert("âŒ Error uploading image: " + uploadError.message)
          return
        }

        // Public URL nikal lo
        const { data: urlData } = supabase.storage
          .from('product-images')
          .getPublicUrl(fileName)

        const imageUrl = urlData.publicUrl

        // Insert product in table
        const { data, error } = await supabase
          .from('products')  // ğŸ‘ˆ apne table ka naam
          .insert([
            { productname: productName, productimage: imageUrl }
          ])

        if (error) {
          console.error(error)
          alert("âŒ Error inserting product: " + error.message)
        } else {
          console.log(data)
          alert("âœ… Product saved successfully with image!")
          form.reset()
        }
      })
    })    


</script>
<body>
  <h1>Supabase CRUD (HTML + JS)</h1>







 <h2>SingUp</h2>
<div>
  <input type="text" id="firstName" placeholder="First Name" />
  <input type="text" id="lastName" placeholder="Last Name" />
  <input type="email" id="signupEmail" placeholder="Email" />
  <input type="number" id="phoneNumber" placeholder="Phone Number" />
     <input type="password" id="signupPassword" placeholder="Password" />
  <button onclick="signUp()">Add User</button>
</div>


<h2>Sign In</h2>
<div>
  <input type="email" id="loginEmail" placeholder="Email" />
  <input type="password" id="loginPassword" placeholder="Password" />
  <button onclick="signIn()">Sign In</button>
</div>

<!-- 
 <div class="box">
    <h2>Sign Up</h2>
    <input type="email" id="signupEmail" placeholder="Enter email" />
    <input type="password" id="signupPassword" placeholder="Enter password" />
    <button onclick="signUp()">Sign Up</button>
  </div> -->

  <!-- Sign In -->
  <div class="box">
    <h2>Sign In</h2>
    <input type="email" id="signinEmail" placeholder="Enter email" />
    <input type="password" id="signinPassword" placeholder="Enter password" />
    <button onclick="signIn()">Sign In</button>
  </div>

 



  <h2>Add Product with Image</h2>

  <form id="productForm">
    <input type="text" id="productName" placeholder="Enter Product Name" required>
    <input type="file" id="productImage" accept="image/*" required>
    <button type="submit">Save</button>
  </form>



  
</body>
</html>
